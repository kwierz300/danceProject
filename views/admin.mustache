<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>{{#t}}Admin panel{{/t}}</title>

  <!-- Bootstrap and custom styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/style.css">

  <!-- Auto-hide alert messages after 5 seconds -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => alert.remove());
      }, 5000);
    });
  </script>
</head>

<body>
  <!-- Reusable navigation bar -->
  {{> navbar}}

  <div class="container mt-5">
    <!-- Success message -->
    {{#successMessage}}
      <div class="alert alert-success text-center">{{successMessage}}</div>
    {{/successMessage}}

    <!-- Error message -->
    {{#errorMessage}}
      <div class="alert alert-danger text-center">{{errorMessage}}</div>
    {{/errorMessage}}

    <!-- Page header -->
    <h1 class="mb-3 text-center">{{#t}}Admin panel{{/t}}</h1>
    <p class="text-center">{{#t}}Logged in as:{{/t}} <strong>{{username}}</strong></p>

    <!-- User search form -->
    <form method="GET" action="/admin" class="mb-5 d-flex justify-content-center gap-2" role="search">
      <input type="text"
             class="form-control w-25"
             name="lastName"
             placeholder="{{#t}}Search by last name...{{/t}}"
             value="{{searchQuery}}">
      <button type="submit" class="btn btn-outline-primary">{{#t}}Search{{/t}}</button>

      {{#searchQuery}}
        <a href="/admin" class="btn btn-outline-secondary">{{#t}}Clear{{/t}}</a>
      {{/searchQuery}}
    </form>

    <hr>

    <!-- Admins table -->
    <div class="table-section">
      <h4 class="text-center mb-3">{{#t}}Admins{{/t}}</h4>
      {{#admins.length}}
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th><a href="/admin?sortBy=firstName&order={{nextOrder}}">{{#t}}First name{{/t}}{{#isSortedByFirstName}}{{sortArrow}}{{/isSortedByFirstName}}</a></th>
              <th><a href="/admin?sortBy=lastName&order={{nextOrder}}">{{#t}}Last name{{/t}}{{#isSortedByLastName}}{{sortArrow}}{{/isSortedByLastName}}</a></th>
              <th><a href="/admin?sortBy=username&order={{nextOrder}}">{{#t}}Username{{/t}}{{#isSortedByUsername}}{{sortArrow}}{{/isSortedByUsername}}</a></th>
              <th>{{#t}}Role{{/t}}</th>
              <th>{{#t}}Actions{{/t}}</th>
            </tr>
          </thead>
          <tbody>
            {{#admins}}
              {{> adminTable }}
            {{/admins}}
          </tbody>
        </table>
      {{/admins.length}}
    </div>

    <!-- Organisers table -->
    <div class="table-section">
      <h4 class="text-center mb-3">{{#t}}Organisers{{/t}}</h4>
      {{#organisers.length}}
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th><a href="/admin?sortBy=firstName&order={{nextOrder}}">{{#t}}First name{{/t}}{{#isSortedByFirstName}}{{sortArrow}}{{/isSortedByFirstName}}</a></th>
              <th><a href="/admin?sortBy=lastName&order={{nextOrder}}">{{#t}}Last name{{/t}}{{#isSortedByLastName}}{{sortArrow}}{{/isSortedByLastName}}</a></th>
              <th><a href="/admin?sortBy=username&order={{nextOrder}}">{{#t}}Username{{/t}}{{#isSortedByUsername}}{{sortArrow}}{{/isSortedByUsername}}</a></th>
              <th>{{#t}}Role{{/t}}</th>
              <th>{{#t}}Actions{{/t}}</th>
            </tr>
          </thead>
          <tbody>
            {{#organisers}}
              {{> adminTable }}
            {{/organisers}}
          </tbody>
        </table>
      {{/organisers.length}}
    </div>

    <!-- Users table -->
    <div class="table-section">
      <h4 class="text-center mb-3">{{#t}}Users{{/t}}</h4>
      {{#users.length}}
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th><a href="/admin?sortBy=firstName&order={{nextOrder}}">{{#t}}First name{{/t}}{{#isSortedByFirstName}}{{sortArrow}}{{/isSortedByFirstName}}</a></th>
              <th><a href="/admin?sortBy=lastName&order={{nextOrder}}">{{#t}}Last name{{/t}}{{#isSortedByLastName}}{{sortArrow}}{{/isSortedByLastName}}</a></th>
              <th><a href="/admin?sortBy=username&order={{nextOrder}}">{{#t}}Username{{/t}}{{#isSortedByUsername}}{{sortArrow}}{{/isSortedByUsername}}</a></th>
              <th>{{#t}}Role{{/t}}</th>
              <th>{{#t}}Actions{{/t}}</th>
            </tr>
          </thead>
          <tbody>
            {{#users}}
              {{> adminTable }}
            {{/users}}
          </tbody>
        </table>
      {{/users.length}}
    </div>
  </div>

  <!-- Optional JS to debug dropdowns  -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropdowns = document.querySelectorAll('.dropdown-toggle');
    });
  </script>

  <!-- Bootstrap JavaScript bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-IYOx1V+rT+nNIX0B2MKa1EMUgq++ZnTrlzqjRBVSkVOqpl5zDkeX2v3MZ8xR7i3v"
          crossorigin="anonymous"></script>
</body>
</html>
